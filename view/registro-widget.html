<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Registro widget</title>

    <%- include ('partials/head.html'); -%>

        <!--IMPORTAR Socket.iot para trabajar con comunicacion socket-->
        <script src="/socket.io/socket.io.js" charset="utf-8"></script>

        <!--Datepicker-->
        <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
</head>

<body class="pagina-registro">

    <div class="container" style="height: 100%;">
        <div class="row" style="height: 100%;">
            <div class="col-sm-11 col-md-9 col-lg-9 mx-auto my-auto">
                <div class="card card-signin">
                    <div class="card-body">

                        <div class="text-center">
                            <img src="/logos/<%= datos.logo %>" height="100px" width="250px">
                        </div>

                        <H2 class="text-center mt-4 mb-2"> Registrar widget</H2>

                        <div id="spinner" style="display: none;">
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <form class="form-signin">
                            <div class="row m-0">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 mt-4">
                                    <div class="form-label-group">
                                        <input type="text" id="input-nombre" class="form-control" placeholder=""
                                            required autofocus>
                                        <label for="input-nombre">Nombre</label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 px-4 html-tablero">
                                    <label>Tablero</label>
                                    <select id="input-tablero" class='mi-selector' style="width: 100%;"
                                        onchange="Funcion_Tablero()">
                                        <option value='0' selected>...</option>
                                        <% for(var i=0; i < cantidad_tableros; i++) { %>
                                            <option value=<%=id_tableros[i] %>><%= tableros[i] %>
                                            </option>
                                            <% } %>
                                    </select>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 mt-4 px-4">
                                    <label>Tipo</label>
                                    <select id="input-tipo" class='mi-selector' style="width: 100%;"
                                        onchange="Funcion_Tipo()">
                                        <option value='0' selected>...</option>
                                        <option value='1' selected>Texto</option>
                                        <option value='2' selected>Interruptor</option>
                                        <option value='8' selected>Boton</option>
                                        <option value='11' selected>Led</option>
                                        <option value='6' selected>Indicador</option>
                                        <option value='3' selected>Deslizador</option>
                                        <option value='7' selected>Perilla</option>
                                        <option value='9' selected>Programador_horario</option>
                                        <option value='4' selected>Grafico_linea</option>
                                        <option value='5' selected>Tabla</option>
                                        <option value='10' selected>Registrador</option>
                                    </select>
                                </div>

                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 px-4 mt-4 html-variable">
                                    <label>Variable</label>
                                    <select id="input-variable" class='mi-selector' style="width: 100%;">
                                        <option value='0' selected>...</option>
                                        <% for(var i=0; i < cantidad_variables; i++) { %>
                                            <option value=<%=id_variables[i] %>><%= variables[i] %> (
                                                    <%=dispositivos_variables[i]%>)</option>
                                            <% } %>
                                    </select>
                                </div>

                                <div class="col-12 col-sm-12 col-md-6 col-lg-6 px-4 mt-4 html-opciones-valores"
                                    style="display :none;">
                                    <label>Valor minimo</label>
                                    <input id="input-min" type="number" value="0.0" data-decimals="1" step="0.1" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-6 col-lg-6 px-4 mt-4 html-opciones-valores"
                                    style="display: none;">
                                    <label>Valor maximo</label>
                                    <input id="input-max" type="number" value="1.0" data-decimals="1" step="0.1" />
                                </div>
                            </div>

                            <div class="row html-activacion-horario ml-1" style="display: none;">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-3 px-4 mt-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="html-dia-horario1">
                                        <label class="form-check-label" for="html-dia-horario1">
                                            Lunes
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-hora-horario"
                                    style="display: none;">
                                    <label>Hora</label>
                                    <input class="picker-hora-style" id="timepicker1" width="110" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-duracion-horario"
                                    style="display: none;">
                                    <label>Duración (seg)</label>
                                    <input id="duracion-horario1" type="number" value="1" data-decimals="0" step="1" />
                                </div>
                            </div>
                            <div class="row html-activacion-horario ml-1" style="display: none;">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-3 px-4 mt-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="html-dia-horario2">
                                        <label class="form-check-label" for="html-dia-horario2">
                                            Martes
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-hora-horario"
                                    style="display: none;">
                                    <label>Hora</label>
                                    <input class="picker-hora-style" id="timepicker2" width="110" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-4 col-lg-4 px-4 mt-4 html-duracion-horario"
                                    style="display: none;">
                                    <label>Duración (seg)</label>
                                    <input id="duracion-horario2" type="number" value="1" data-decimals="0" step="1" />
                                </div>
                            </div>
                            <div class="row html-activacion-horario ml-1" style="display: none;">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-3 px-4 mt-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="html-dia-horario3">
                                        <label class="form-check-label" for="html-dia-horario3">
                                            Miercoles
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-hora-horario"
                                    style="display: none;">
                                    <label>Hora</label>
                                    <input class="picker-hora-style" id="timepicker3" width="110" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-duracion-horario"
                                    style="display: none;">
                                    <label>Duración (seg)</label>
                                    <input id="duracion-horario3" type="number" value="1" data-decimals="0" step="1" />
                                </div>
                            </div>
                            <div class="row html-activacion-horario ml-1" style="display: none;">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-3 px-4 mt-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="html-dia-horario4">
                                        <label class="form-check-label" for="html-dia-horario4">
                                            Jueves
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-hora-horario"
                                    style="display: none;">
                                    <label>Hora</label>
                                    <input class="picker-hora-style" id="timepicker4" width="110" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-duracion-horario"
                                    style="display: none;">
                                    <label>Duración (seg)</label>
                                    <input id="duracion-horario4" type="number" value="1" data-decimals="0" step="1" />
                                </div>
                            </div>
                            <div class="row html-activacion-horario ml-1" style="display: none;">
                                <div class="col-12 col-sm-12 col-md-412col-lg-3 px-4 mt-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="html-dia-horario5">
                                        <label class="form-check-label" for="html-dia-horario5">
                                            Viernes
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-hora-horario"
                                    style="display: none;">
                                    <label>Hora</label>
                                    <input class="picker-hora-style" id="timepicker5" width="110" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-duracion-horario"
                                    style="display: none;">
                                    <label>Duración (seg)</label>
                                    <input id="duracion-horario5" type="number" value="1" data-decimals="0" step="1" />
                                </div>
                            </div>
                            <div class="row html-activacion-horario ml-1" style="display: none;">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-3 px-4 mt-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="html-dia-horario6">
                                        <label class="form-check-label" for="html-dia-horario6">
                                            Sabado
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-hora-horario"
                                    style="display: none;">
                                    <label>Hora</label>
                                    <input class="picker-hora-style" id="timepicker6" width="110" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-duracion-horario"
                                    style="display: none;">
                                    <label>Duración (seg)</label>
                                    <input id="duracion-horario6" type="number" value="1" data-decimals="0" step="1" />
                                </div>
                            </div>

                            <div class="row html-activacion-horario ml-1" style="display: none;">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-3 px-4 mt-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="" id="html-dia-horario7">
                                        <label class="form-check-label" for="html-dia-horario7">
                                            Domingo
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-hora-horario"
                                    style="display: none;">
                                    <label>Hora</label>
                                    <input class="picker-hora-style" id="timepicker7" width="110" />
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-4 px-4 mt-4 html-duracion-horario"
                                    style="display: none;">
                                    <label>Duración (seg)</label>
                                    <input id="duracion-horario7" type="number" value="1" data-decimals="0" step="1" />
                                </div>
                            </div>

                            <div class="row m-0">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 mt-4 px-4 html-opciones-funcion">
                                    <label>Función</label>
                                    <select id="input-funcion" class='mi-selector' style="width: 100%;">
                                        <option value='0' selected>...</option>
                                        <option value='1'>Monitorear</option>
                                        <option value='2'>Controlar</option>
                                    </select>
                                </div>

                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 mt-4 html-opciones-interruptor"
                                    style="display: none;">
                                    <div class="form-label-group">
                                        <input type="text" id="input-msj-off" class="form-control" placeholder=""
                                            required autofocus>
                                        <label for="input-msj-off">Mensaje para OFF</label>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 mt-2 html-opciones-interruptor"
                                    style="display: none;">
                                    <div class="form-label-group">
                                        <input type="text" id="input-msj-on" class="form-control" placeholder=""
                                            required autofocus>
                                        <label for="input-msj-on">Mensaje para ON</label>
                                    </div>
                                </div>

                                <div class="col-12 col-sm-12 col-md-12 col-lg-12 mt-4 px-4 html-estancias">
                                    <label>Selecciona la estancia (Opcional)</label>
                                    <select id="input-estancia" class='mi-selector' style="width: 100%;">
                                    </select>
                                </div>
                            </div>
                        </form>

                        <div class="html-sesion-tabla1" style="display: none; width: 100%;">
                            <div id="html-sesion-tabla2">
                                <div class="row row-columnas-tabla m-0">
                                    <div class="col-12 col-sm-12 col-md-5 col-lg-5 px-4 mt-4">
                                        <label>C1: Titulo</label>
                                        <div class="form-label-group" style="width: 100%;">
                                            <input type="text" id="input-columna-tabla-0" class="form-control"
                                                placeholder="" required autofocus style="height: 28px !important;">
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-12 col-md-6 col-lg-6 px-4 mt-0 mt-lg-4 mt-md-4">
                                        <label>Variable</label>
                                        <select id="input-variable-tabla-0" class="mi-selector" style="width: 100%;">
                                            <option value='0' selected>...</option>
                                            <% for(var i=0; i < cantidad_variables; i++) { %>
                                                <option value=<%=id_variables[i] %>><%= variables[i] %> (
                                                        <%=dispositivos_variables[i]%>)</option>
                                                <% } %>
                                        </select>
                                    </div>
                                    <div
                                        class="col-12 col-sm-12 col-md-1 col-lg-1 px-1 mt-1 mt-md-5 mt-lg-5 text-center">
                                        <div class="btn-eliminar-tabla mt-1">
                                            <span id="span-tabla-0" style="font-size: 30px !important;"
                                                class="iconify ml-3 span-delete-accion mt-1" data-icon="mi:delete"
                                                onclick="Funcion_Delete_Tabla(this)"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center mt-4 mb-3">
                                <button id="btn-añadir-tabla" type="button" class="btn btn-primary btn-sm"
                                    style="border-radius: 5rem;  transition: all 0.2s; width: 140px;">
                                    <span class='iconify mr-1' data-icon='fluent:add-12-filled'
                                        style='font-size: 100%;'></span>
                                    Añadir columna
                                </button>
                            </div>
                        </div>

                        <div class="d-flex justify-content-center mt-4 mb-3">
                            <button id="btn-volver" type="button"
                                class="btn btn-outline-primary btn-lg mr-3 mr-lg-5 px-4"
                                style="border-radius: 5rem;  transition: all 0.2s;">Regresar</button>
                            <button id="btn-aceptar" type="button" class="btn btn-primary btn-lg ml-3 ml-lg-5 px-4"
                                style="border-radius: 5rem;  transition: all 0.2s;">Aceptar</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include ('partials/footer.html'); -%>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

        <script src="/js/bootstrap-input-spinner.js"></script>

        <!--Datepicker-->
        <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>

        <script>
            $("input[type='number']").inputSpinner()

            // Declaracion de variables
            window.usuario = "<%= datos.id %>"
            var aux_id_estancias = "<%= id_estancias %>"
            var aux_estancias = "<%= estancias %>"
            var aux_id_tablero_estancias = "<%= id_tablero_estancias %>"
            var aux_tablero_estancias = "<%= tablero_estancias %>"

            var array_id_estancias = aux_id_estancias.split(',');
            var array_estancias = aux_estancias.split(',');
            var array_id_tablero_estancias = aux_id_tablero_estancias.split(',');
            var array_tablero_estancias = aux_tablero_estancias.split(',');

            document.getElementById("input-tablero").value = "0";
            document.getElementById("input-tipo").value = "0";
            document.getElementById("input-variable").value = "0";
            document.getElementById("input-msj-off").value = "";
            document.getElementById("input-msj-on").value = "";
            document.getElementById("input-funcion").value = "0";

            window.cantidad_val = 0;

            // Programador horario
            var hora_horario = ["8:0", "8:0", "8:0", "8:0", "8:0", "8:0", "8.0"];

            // Crear cliente socket
            const socket = io({
                autoConnect: true
            });

            // TIMEPICKERS
            var time1 = $('#timepicker1').timepicker({
                uiLibrary: 'bootstrap4',
                format: 'HH.MM',
                footer: true,
                modal: true,
                icons: {
                    rightIcon: '<i style="color: #0275d8;" class="far fa-clock mb-1"></i>'
                },
                mode: 'ampm',
                value: '08.00',
                change: function (e) {
                    var time = $('#timepicker1').val()
                    var horario = time.split(".")
                    hora_horario[1] = horario[0] + ":" + horario[1];
                }
            });
            var time2 = $('#timepicker2').timepicker({
                uiLibrary: 'bootstrap4',
                format: 'HH.MM',
                footer: true,
                modal: true,
                icons: {
                    rightIcon: '<i style="color: #0275d8;" class="far fa-clock mb-1"></i>'
                },
                mode: 'ampm',
                value: '08.00',
                change: function (e) {
                    var time = $('#timepicker2').val()
                    var horario = time.split(".")
                    hora_horario[2] = horario[0] + ":" + horario[1];
                }
            });
            var time3 = $('#timepicker3').timepicker({
                uiLibrary: 'bootstrap4',
                format: 'HH.MM',
                footer: true,
                modal: true,
                icons: {
                    rightIcon: '<i style="color: #0275d8;" class="far fa-clock mb-1"></i>'
                },
                mode: 'ampm',
                value: '08.00',
                change: function (e) {
                    var time = $('#timepicker3').val()
                    var horario = time.split(".")
                    hora_horario[3] = horario[0] + ":" + horario[1];
                }
            });
            var time4 = $('#timepicker4').timepicker({
                uiLibrary: 'bootstrap4',
                format: 'HH.MM',
                footer: true,
                modal: true,
                icons: {
                    rightIcon: '<i style="color: #0275d8;" class="far fa-clock mb-1"></i>'
                },
                mode: 'ampm',
                value: '08.00',
                change: function (e) {
                    var time = $('#timepicker4').val()
                    var horario = time.split(".")
                    hora_horario[4] = horario[0] + ":" + horario[1];
                }
            });
            var time5 = $('#timepicker5').timepicker({
                uiLibrary: 'bootstrap4',
                format: 'HH.MM',
                footer: true,
                modal: true,
                icons: {
                    rightIcon: '<i style="color: #0275d8;" class="far fa-clock mb-1"></i>'
                },
                mode: 'ampm',
                value: '08.00',
                change: function (e) {
                    var time = $('#timepicker5').val()
                    var horario = time.split(".")
                    hora_horario[5] = horario[0] + ":" + horario[1];
                }
            });
            var time6 = $('#timepicker6').timepicker({
                uiLibrary: 'bootstrap4',
                format: 'HH.MM',
                footer: true,
                modal: true,
                icons: {
                    rightIcon: '<i style="color: #0275d8;" class="far fa-clock mb-1"></i>'
                },
                mode: 'ampm',
                value: '08.00',
                change: function (e) {
                    var time = $('#timepicker6').val()
                    var horario = time.split(".")
                    hora_horario[6] = horario[0] + ":" + horario[1];
                }
            });
            var time7 = $('#timepicker7').timepicker({
                uiLibrary: 'bootstrap4',
                format: 'HH.MM',
                footer: true,
                modal: true,
                icons: {
                    rightIcon: '<i style="color: #0275d8;" class="far fa-clock mb-1"></i>'
                },
                mode: 'ampm',
                value: '08.00',
                change: function (e) {
                    var time = $('#timepicker7').val()
                    var horario = time.split(".")
                    hora_horario[0] = horario[0] + ":" + horario[1];
                }
            });

            // Escuchar cambios de check
            $("#html-dia-horario1").change(function () {
                var val = document.getElementById("html-dia-horario1").checked;
                if (val == true) {
                    document.getElementsByClassName("html-hora-horario")[0].style.display = "block";
                    document.getElementsByClassName("html-duracion-horario")[0].style.display = "block";
                } else {
                    document.getElementsByClassName("html-hora-horario")[0].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[0].style.display = "none";
                }
            });
            $("#html-dia-horario2").change(function () {
                var val = document.getElementById("html-dia-horario2").checked;
                if (val == true) {
                    document.getElementsByClassName("html-hora-horario")[1].style.display = "block";
                    document.getElementsByClassName("html-duracion-horario")[1].style.display = "block";
                } else {
                    document.getElementsByClassName("html-hora-horario")[1].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[1].style.display = "none";
                }
            });
            $("#html-dia-horario3").change(function () {
                var val = document.getElementById("html-dia-horario3").checked;
                if (val == true) {
                    document.getElementsByClassName("html-hora-horario")[2].style.display = "block";
                    document.getElementsByClassName("html-duracion-horario")[2].style.display = "block";
                } else {
                    document.getElementsByClassName("html-hora-horario")[2].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[2].style.display = "none";
                }
            });
            $("#html-dia-horario4").change(function () {
                var val = document.getElementById("html-dia-horario4").checked;
                if (val == true) {
                    document.getElementsByClassName("html-hora-horario")[3].style.display = "block";
                    document.getElementsByClassName("html-duracion-horario")[3].style.display = "block";
                } else {
                    document.getElementsByClassName("html-hora-horario")[3].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[3].style.display = "none";
                }
            });
            $("#html-dia-horario5").change(function () {
                var val = document.getElementById("html-dia-horario5").checked;
                if (val == true) {
                    document.getElementsByClassName("html-hora-horario")[4].style.display = "block";
                    document.getElementsByClassName("html-duracion-horario")[4].style.display = "block";
                } else {
                    document.getElementsByClassName("html-hora-horario")[4].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[4].style.display = "none";
                }
            });
            $("#html-dia-horario6").change(function () {
                var val = document.getElementById("html-dia-horario6").checked;
                if (val == true) {
                    document.getElementsByClassName("html-hora-horario")[5].style.display = "block";
                    document.getElementsByClassName("html-duracion-horario")[5].style.display = "block";
                } else {
                    document.getElementsByClassName("html-hora-horario")[5].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[5].style.display = "none";
                }
            });
            $("#html-dia-horario7").change(function () {
                var val = document.getElementById("html-dia-horario7").checked;
                if (val == true) {
                    document.getElementsByClassName("html-hora-horario")[6].style.display = "block";
                    document.getElementsByClassName("html-duracion-horario")[6].style.display = "block";
                } else {
                    document.getElementsByClassName("html-hora-horario")[6].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[6].style.display = "none";
                }
            });

            function Funcion_Tablero() {
                // Limpiar input select de estancias
                $("#input-estancia").find('option').remove();
                // Encontrar id del tablero seleccionado
                var id_tablero_actual = document.getElementById("input-tablero").value;
                for (var i = 0; i < parseInt(array_id_estancias.length); i++) {
                    if (array_id_tablero_estancias[i] == id_tablero_actual) {
                        const option = document.createElement('option');
                        option.value = array_id_estancias[i];
                        option.text = array_estancias[i];
                        document.getElementById("input-estancia").appendChild(option);
                    }
                }
            }

            function Funcion_Tipo() {
                var texto_tipo = $("#input-tipo").find('option:selected').text();
                document.getElementsByClassName("html-opciones-interruptor")[0].style.display = "none";
                document.getElementsByClassName("html-opciones-interruptor")[1].style.display = "none";
                document.getElementsByClassName("html-opciones-valores")[0].style.display = "none";
                document.getElementsByClassName("html-opciones-valores")[1].style.display = "none";
                document.getElementsByClassName("html-opciones-funcion")[0].style.display = "block";
                document.getElementsByClassName("html-estancias")[0].style.display = "block";
                document.getElementsByClassName("html-variable")[0].style.display = "block";
                document.getElementsByClassName("html-sesion-tabla1")[0].style.display = "none";
                document.getElementsByClassName("html-tablero")[0].style.display = "block";
                for (var i = 0; i < 7; i++) {
                    document.getElementsByClassName("html-activacion-horario")[i].style.display = "none";
                    document.getElementsByClassName("html-hora-horario")[i].style.display = "none";
                    document.getElementsByClassName("html-duracion-horario")[i].style.display = "none";
                }
                // Check y duracion
                document.getElementById("html-dia-horario1").checked = false;
                document.getElementById("html-dia-horario2").checked = false;
                document.getElementById("html-dia-horario3").checked = false;
                document.getElementById("html-dia-horario4").checked = false;
                document.getElementById("html-dia-horario5").checked = false;
                document.getElementById("html-dia-horario6").checked = false;
                document.getElementById("html-dia-horario7").checked = false;

                if (texto_tipo == "Texto") {
                    document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                } else if (texto_tipo == "Interruptor") {
                    document.getElementsByClassName("html-opciones-interruptor")[0].style.display = "block";
                    document.getElementsByClassName("html-opciones-interruptor")[1].style.display = "block";
                } else if ((texto_tipo == "Deslizador") || (texto_tipo == "Indicador") || (texto_tipo == "Perilla")) {
                    document.getElementsByClassName("html-opciones-valores")[0].style.display = "block";
                    document.getElementsByClassName("html-opciones-valores")[1].style.display = "block";
                    if ((texto_tipo == "Indicador") || (texto_tipo == "Perilla")) {
                        document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                    }
                } else if (texto_tipo == "Grafico_linea") {
                    document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                    document.getElementsByClassName("html-estancias")[0].style.display = "none";
                } else if (texto_tipo == "Tabla") {
                    document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                    document.getElementsByClassName("html-sesion-tabla1")[0].style.display = "block";
                    document.getElementsByClassName("html-variable")[0].style.display = "none";
                } else if (texto_tipo == "Boton") {
                    document.getElementsByClassName("html-opciones-interruptor")[0].style.display = "none";
                    document.getElementsByClassName("html-opciones-interruptor")[1].style.display = "none";
                    document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                } else if (texto_tipo == "Programador_horario") {
                    document.getElementsByClassName("html-tablero")[0].style.display = "none";
                    document.getElementsByClassName("html-opciones-interruptor")[0].style.display = "none";
                    document.getElementsByClassName("html-opciones-interruptor")[1].style.display = "none";
                    document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                    document.getElementsByClassName("html-estancias")[0].style.display = "none";
                    for (var i = 0; i < 7; i++) {
                        document.getElementsByClassName("html-activacion-horario")[i].style.display = "block";
                    }
                } else if (texto_tipo == "Registrador") {
                    document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                    document.getElementsByClassName("html-estancias")[0].style.display = "none";
                } else if (texto_tipo == "Led") {
                    document.getElementsByClassName("html-opciones-funcion")[0].style.display = "none";
                    document.getElementsByClassName("html-variable")[0].style.display = "none";
                }
            }

            // Eliminar una columna de una tabla
            function Funcion_Delete_Tabla(dato) {
                var aux_id = dato.id;
                var id = aux_id.split("-")[2];
                console.log("Funcion delete", id)

                document.getElementsByClassName("row-columnas-tabla")[id].style.display = "none";
                return false;

                var cantidad = 0;
                var aux_cantidad = parseInt(document.getElementsByClassName("row-eventos").length);
                for (var i = 0; i < aux_cantidad; i++) {
                    if (document.getElementsByClassName("row-eventos")[i].style.display != "none") {
                        cantidad = cantidad + 1;
                    }
                }

                if (cantidad == 1) {
                    document.getElementById("btn-and").style.display = "block";
                    document.getElementById("btn-or").style.display = "block";
                }
            }

            $(document).ready(function () {
                jQuery(document).ready(function ($) {
                    $(document).ready(function () {
                        $('.mi-selector').select2();
                    });
                });

                $("#btn-volver").click(function () {
                    window.location.href = "/panel-usuario";
                });

                $("#btn-añadir-tabla").click(function () {
                    window.cantidad_val = window.cantidad_val + 1;
                    var aux = window.cantidad_val + 1;
                    $('#html-sesion-tabla2').append('<div class="row row-columnas-tabla m-0">' +
                        '<div class="col-12 col-sm-12 col-md-5 col-lg-5 px-4 mt-4">' +
                        '<label>C' + aux + ': Titulo</label>' +
                        '<div class="form-label-group" style="width: 100%;">' +
                        '<input type="text" id="input-columna-tabla-' + window.cantidad_val + '" class="form-control"' +
                        'placeholder="" required autofocus style="height: 28px !important;">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-12 col-sm-12 col-md-6 col-lg-6 px-4 mt-0 mt-lg-4 mt-md-4">' +
                        '<label>Variable</label>' +
                        '<select id="input-variable-tabla-' + window.cantidad_val + '" class="mi-selector" style="width: 100%;">' +
                        '<option value="0" selected>...</option>' +
                        '<% for(var i=0; i < cantidad_variables; i++) { %>' +
                        '<option value=<%=id_variables[i] %>><%= variables[i] %> (' +
                        '<%=dispositivos_variables[i]%>)</option>' +
                        '<% } %>' +
                        '</select>' +
                        '</div>' +
                        '<div' +
                        ' class="col-12 col-sm-12 col-md-1 col-lg-1 px-1 mt-1 mt-md-5 mt-lg-5 text-center">' +
                        '<div class="btn-eliminar-tabla mt-1">' +
                        '<span id="span-tabla-' + window.cantidad_val + '" style="font-size: 30px !important;"' +
                        'class="iconify ml-3 span-delete-accion mt-1" data-icon="mi:delete"' +
                        'onclick="Funcion_Delete_Tabla(this)"></span>' +
                        '</div>' +
                        '</div>' +
                        '</div>');
                    $(document).ready(function () {
                        $('.mi-selector').select2();
                    });
                });

                $("#btn-aceptar").click(function () {
                    var aux_tipo = document.getElementById("input-tipo").value;
                    var tipo = $("#input-tipo").find('option:selected').text();
                    var nombre = document.getElementById("input-nombre").value;
                    var id_variable = document.getElementById("input-variable").value;
                    var variable = $("#input-variable").find('option:selected').text();
                    var min = document.getElementById("input-min").value;
                    var max = document.getElementById("input-max").value;
                    var msj_off = document.getElementById("input-msj-off").value;
                    var msj_on = document.getElementById("input-msj-on").value;
                    var funcion = $("#input-funcion").find('option:selected').text();
                    var id_estancia = document.getElementById("input-estancia").value;
                    var estancia = $("#input-estancia").find('option:selected').text();
                    var id_tablero = document.getElementById("input-tablero").value;
                    var tablero = $("#input-tablero").find('option:selected').text();

                    // Programador horario (la primera es hora_horario)
                    var dias_horario = [0, 0, 0, 0, 0, 0, 0];
                    var duracion_horario = [0, 0, 0, 0, 0, 0, 0];
                    if (tipo == "Programador_horario") {
                        if (document.getElementById("html-dia-horario1").checked == true) {
                            dias_horario[1] = 1;
                            duracion_horario[1] = parseInt(document.getElementById("duracion-horario1").value);
                        }
                        if (document.getElementById("html-dia-horario2").checked == true) {
                            dias_horario[2] = 1;
                            duracion_horario[2] = parseInt(document.getElementById("duracion-horario2").value);
                        }
                        if (document.getElementById("html-dia-horario3").checked == true) {
                            dias_horario[3] = 1;
                            duracion_horario[3] = parseInt(document.getElementById("duracion-horario3").value);
                        }
                        if (document.getElementById("html-dia-horario4").checked == true) {
                            dias_horario[4] = 1;
                            duracion_horario[4] = parseInt(document.getElementById("duracion-horario4").value);
                        }
                        if (document.getElementById("html-dia-horario5").checked == true) {
                            dias_horario[5] = 1;
                            duracion_horario[5] = parseInt(document.getElementById("duracion-horario5").value);
                        }
                        if (document.getElementById("html-dia-horario6").checked == true) {
                            dias_horario[6] = 1;
                            duracion_horario[6] = parseInt(document.getElementById("duracion-horario6").value);
                        }
                        if (document.getElementById("html-dia-horario7").checked == true) {
                            dias_horario[0] = 1;
                            duracion_horario[0] = parseInt(document.getElementById("duracion-horario7").value);
                        }
                    }
                    var string_dias_horario = "",
                        string_hora_horario = "",
                        string_duracion_horario = "";
                    for (var i = 0; i < 7; i++) {
                        string_dias_horario = string_dias_horario + "," + dias_horario[i];
                        string_hora_horario = string_hora_horario + "," + hora_horario[i];
                        string_duracion_horario = string_duracion_horario + "," + duracion_horario[i];
                    }

                    // Verificar que seleccion tipo de widget
                    if (aux_tipo == 0) {
                        $.alert('' +
                            '<label>Tienes que seleccionar un tipo de widget</label>' +
                            '<div class="text-center">' +
                            '<i class="fas fa-times fa-4x"></i>' +
                            '</div>');
                        return false;
                    }
                    // Verificar que ingreso nombre
                    if (nombre.length == 0) {
                        $.alert('' +
                            '<label>El nombre del widget no puede ser nulo</label>' +
                            '<div class="text-center">' +
                            '<i class="fas fa-times fa-4x"></i>' +
                            '</div>');
                        return false;
                    }
                    // Verificar que selecciono variable 
                    if ((id_variable == 0) && (tipo != "Tabla") && (tipo != "Led")) {
                        $.alert('' +
                            '<label>Tienes que seleccionar una variable para el widget</label>' +
                            '<div class="text-center">' +
                            '<i class="fas fa-times fa-4x"></i>' +
                            '</div>');
                        return false;
                    }
                    // Verificar que selecciono funcion del widget
                    if ((tipo != "Texto") && (tipo != "Boton") && (tipo != "Boton_Temporizador") && (tipo != "Indicador") && (tipo != "Perilla") && (tipo != "Grafico_linea") && (tipo != "Programador_horario") && (tipo != "Registrador") && (tipo != "Tabla") && (tipo != "Led")) {
                        if (funcion.length == 0) {
                            $.alert('' +
                                '<label>Tienes que seleccionar una función para el widget</label>' +
                                '<div class="text-center">' +
                                '<i class="fas fa-times fa-4x"></i>' +
                                '</div>');
                            return false;
                        }
                    }
                    // Verificar que selecciono tablero
                    if (tipo != "Programador_horario") {
                        if (tablero == "...") {
                            $.alert('' +
                                '<label>Tienes que seleccionar un tablero</label>' +
                                '<div class="text-center">' +
                                '<i class="fas fa-times fa-4x"></i>' +
                                '</div>');
                            return false;
                        }
                    }

                    // Verificar para tabla
                    var columnas_tabla = "";
                    if (tipo == "Tabla") {
                        // Columnas
                        var aux_columnas = parseInt(document.getElementsByClassName("row-columnas-tabla").length);
                        for (var i = 0; i < aux_columnas; i++) {
                            if (document.getElementsByClassName("row-columnas-tabla")[i].style.display != "none") {
                                // Nombre de columna
                                var id_nombre_columna_tabla = "input-columna-tabla-" + i;
                                var aux_tabla_html1 = document.getElementById(id_nombre_columna_tabla);
                                aux_tabla_html1 = aux_tabla_html1.value;
                                // Variable de la columna
                                var id_variable_columna_tabla = "input-variable-tabla-" + i;
                                var aux_tabla_html2 = document.getElementById(id_variable_columna_tabla);
                                aux_tabla_html2 = aux_tabla_html2.value;
                                columnas_tabla = columnas_tabla + '*{"nombre_col":"' + aux_tabla_html1 + '","id_variable":"' + aux_tabla_html2 + '"}';
                            }
                        }
                    }
                    console.log(columnas_tabla)

                    var mensaje = '¿Deseas registrar el widget ' + nombre + ' del tipo ' + tipo + '?';

                    // Procesar campos de los widets
                    // Tabla
                    if (tipo != "Tabla") {
                        aux_variable = variable.split(' ');
                        variable = aux_variable[0];
                    } else {
                        id_variable = 0;
                        variable = columnas_tabla;
                    }

                    //  Texto
                    if (tipo == "Texto") {
                        msj_off = "";
                        msj_on = "";
                        funcion = "Monitorear"
                    }
                    if (tipo == "Deslizador") {
                        msj_off = "";
                        msj_on = "";
                    }
                    if (tipo == "Indicador") {
                        msj_off = "";
                        msj_on = "";
                        funcion = "Monitorear"
                    }
                    if (tipo == "Perilla") {
                        msj_off = "";
                        msj_on = "";
                        funcion = "Controlar"
                    }
                    if (tipo == "Led") {
                        msj_off = "";
                        msj_on = "";
                        funcion = "Monitorear"
                    }
                    if (tipo == "Grafico_Linea") {
                        msj_off = "";
                        msj_on = "";
                        funcion = ""
                    }
                    if (tipo == "Registrador") {
                        msj_off = "";
                        msj_on = "";
                        funcion = ""
                    }
                    if (tipo == "Tabla") {
                        funcion = "Monitorear";
                    }
                    if (tipo == "Boton") {
                        msj_off = "";
                        msj_on = "";
                        funcion = "Controlar"
                    }
                    if (tipo == "Programador_horario") {
                        msj_off = "";
                        msj_on = "";
                        funcion = "Controlar"
                    }

                    // Color widget para led
                    var color_widget = "";
                    if (tipo == "Led") {
                        funcion = "Monitorear";
                        color_widget = "#FFFFFF80";
                    }

                    $.confirm({
                        title: 'Confimar',
                        content: mensaje,
                        buttons: {
                            Si: function () {
                                document.getElementById("spinner").style.display = "block"
                                $.post("/datos-registro-bd", {
                                    id_tablero,
                                    tablero,
                                    nombre,
                                    tipo,
                                    id_variable,
                                    variable,
                                    min,
                                    max,
                                    funcion,
                                    id_estancia,
                                    estancia,
                                    msj_off,
                                    msj_on,
                                    string_dias_horario,
                                    string_hora_horario,
                                    string_duracion_horario,
                                    color: color_widget,
                                    bd: "widgets"
                                }, function (res) {
                                    console.log(res)
                                    respuesta = res;
                                    if (respuesta == "Ya existe")
                                        $.alert('' +
                                            '<label>El nombre del widget ya existe</label>' +
                                            '<div class="text-center">' +
                                            '<i class="fas fa-times fa-4x"></i>' +
                                            '</div>');
                                    else if (respuesta == "Error") {
                                        $.alert('' +
                                            '<label>Error al registrar</label>' +
                                            '<div class="text-center">' +
                                            '<i class="fas fa-times fa-4x"></i>' +
                                            '</div>');
                                    } else {
                                        $("#input-tipo").val("0").trigger("change");
                                        $("#input-variable").val("0").trigger("change");
                                        document.getElementById("input-msj-off").value = ""
                                        document.getElementById("input-msj-on").value = ""
                                        $("#input-funcion").val("0").trigger("change");
                                        $.alert('' +
                                            '<label>Widget registrado exitosamente.' +
                                            '</label>' +
                                            '<div class="text-center">' +
                                            '<i class="fas fa-check fa-4x"></i>' +
                                            '</div>');
                                    }
                                }).done(function () {
                                    document.getElementById("spinner").style.display = "none"
                                });
                            },
                            No: function () { },
                        }
                    });
                });
            });
        </script>

        <script>
            $(document).ready(function () {
                var height = $(window).height();
                $('.pagina-registro').height(height);
            });

            // Para detectar cambio de pantalla
            $(window).resize(function () {
                var height = $(window).height();
                $('.pagina-registro').height(height);
            });
        </script>

</body>

</html>